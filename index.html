<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
  <meta name="theme-color" content="#1a1a2e">
  <meta name="description" content="Jogo de RPG em Realidade Aumentada inspirado em Dungeons & Dragons">


  <!-- PWA -->
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">

  <title>D&D AR Adventure</title>
  <link rel="stylesheet" href="/src/styles/main.css">
</head>

<body>
  <div id="app">
    <!-- Loading Screen -->
    <div id="loading-screen" class="screen active">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <h1>D&D AR Adventure</h1>
        <pre id="loading-status"
          style="max-width: 90vw; max-height: 50vh; overflow: auto; white-space: pre-wrap; word-break: break-word; font-size: 12px; text-align: left; padding: 10px; background: rgba(0,0,0,0.5); border-radius: 8px;">Verificando compatibilidade...</pre>
      </div>
    </div>

    <!-- Incompatible Screen -->
    <div id="incompatible-screen" class="screen">
      <div class="incompatible-content">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <h1>Aparelho Incompat√≠vel</h1>
        <p>Seu dispositivo n√£o suporta os recursos necess√°rios para jogar.</p>
        <div id="failed-requirements" class="requirements-list"></div>
        <div class="compatible-devices">
          <h3>Dispositivos compat√≠veis:</h3>
          <ul>
            <li>Samsung Galaxy S8 ou superior</li>
            <li>Google Pixel 2 ou superior</li>
            <li>Xiaomi Mi 9 ou superior</li>
            <li>OnePlus 6 ou superior</li>
          </ul>
          <a href="https://developers.google.com/ar/devices" target="_blank" class="btn-link">
            Lista completa de dispositivos ARCore
          </a>
        </div>
      </div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="screen">
      <div class="login-container">
        <h1>D&D AR Adventure</h1>
        <div class="login-tabs">
          <button class="tab-btn active" data-tab="login">Entrar</button>
          <button class="tab-btn" data-tab="register">Cadastrar</button>
        </div>

        <form id="login-form" class="auth-form active">
          <div class="form-group">
            <label for="login-email">Email</label>
            <input type="email" id="login-email" required autocomplete="email">
          </div>
          <div class="form-group">
            <label for="login-password">Senha</label>
            <input type="password" id="login-password" required autocomplete="current-password">
          </div>
          <button type="submit" class="btn-primary">Entrar</button>
          <p id="login-error" class="error-message"></p>
        </form>

        <form id="register-form" class="auth-form">
          <div class="form-group">
            <label for="register-name">Nome do Aventureiro</label>
            <input type="text" id="register-name" required minlength="3" maxlength="20">
          </div>
          <div class="form-group">
            <label for="register-email">Email</label>
            <input type="email" id="register-email" required autocomplete="email">
          </div>
          <div class="form-group">
            <label for="register-password">Senha</label>
            <input type="password" id="register-password" required minlength="6" autocomplete="new-password">
          </div>
          <button type="submit" class="btn-primary">Criar Conta</button>
          <p id="register-error" class="error-message"></p>
        </form>
      </div>
    </div>

    <!-- Character Creation Screen -->
    <div id="character-screen" class="screen">
      <div class="character-container">
        <h1>Crie seu Personagem</h1>
        <form id="character-form">
          <div class="class-selection">
            <h2>Escolha sua Classe</h2>
            <div class="class-grid">
              <button type="button" class="class-btn" data-class="warrior">
                <img src="/icons/class_warrior.png" alt="Guerreiro" class="class-icon-img">
                <span class="class-name">Guerreiro</span>
                <span class="class-desc">Alto HP, tanque</span>
              </button>
              <button type="button" class="class-btn" data-class="mage">
                <img src="/icons/class_mage.png" alt="Mago" class="class-icon-img">
                <span class="class-name">Mago</span>
                <span class="class-desc">Alto dano m√°gico</span>
              </button>
              <button type="button" class="class-btn" data-class="archer">
                <img src="/icons/class_archer.png" alt="Arqueiro" class="class-icon-img">
                <span class="class-name">Arqueiro</span>
                <span class="class-desc">Cr√≠ticos devastadores</span>
              </button>
              <button type="button" class="class-btn" data-class="cleric">
                <img src="/icons/class_cleric.png" alt="Cl√©rigo" class="class-icon-img">
                <span class="class-name">Cl√©rigo</span>
                <span class="class-desc">Suporte e cura</span>
              </button>
            </div>
          </div>
          <button type="submit" class="btn-primary" id="create-character-btn" disabled>
            Come√ßar Aventura
          </button>
        </form>
      </div>
    </div>

    <!-- Map Screen -->
    <div id="map-screen" class="screen">
      <div id="map-container"></div>
      <div id="map-hud">
        <div class="player-info">
          <div class="player-avatar" id="player-avatar">‚öîÔ∏è</div>
          <div class="player-stats">
            <span id="player-name">Aventureiro</span>
            <span id="player-level">N√≠vel 1</span>
          </div>
        </div>
        <div class="compass" id="compass">
          <span class="compass-arrow">‚Üë</span>
          <span class="compass-label">N</span>
        </div>
      </div>

      <!-- Map Action Buttons -->
      <div class="map-actions">
        <button class="map-btn" id="inventory-btn" title="Invent√°rio">
          <img src="/icons/ui_icon_inventory.png" alt="Invent√°rio" class="map-btn-icon">
        </button>
        <button class="map-btn" id="character-btn" title="Personagem">
          <img src="/icons/ui_icon_character.png" alt="Personagem" class="map-btn-icon">
        </button>
        <button class="map-btn" id="explore-btn" title="Explorar">
          <img src="/icons/ui_icon_explore.png" alt="Explorar" class="map-btn-icon">
        </button>
      </div>

      <div id="monster-panel" class="panel hidden">
        <div class="panel-content">
          <h3 id="monster-name">Goblin</h3>
          <div class="monster-stats">
            <span id="monster-hp">HP: 7/7</span>
            <span id="monster-level">CR: 1/4</span>
          </div>
          <button id="enter-ar-btn" class="btn-primary">Entrar em Combate AR</button>
        </div>
      </div>

      <!-- Admin Button (discreto) -->
      <button id="admin-toggle-btn" class="admin-toggle" title="Modo Admin">‚öôÔ∏è</button>
    </div>

    <!-- Admin Panel -->
    <div id="admin-screen" class="screen overlay">
      <div class="admin-container">
        <div class="admin-header">
          <h1>üó∫Ô∏è Editor de Campanha</h1>
          <button id="close-admin-btn" class="btn-close">√ó</button>
        </div>

        <div class="admin-tabs">
          <button class="admin-tab active" data-tab="add-poi">Adicionar POI</button>
          <button class="admin-tab" data-tab="list-pois">Lista de POIs</button>
          <button class="admin-tab" data-tab="export">Exportar</button>
        </div>

        <!-- Tab: Adicionar POI -->
        <div id="tab-add-poi" class="admin-tab-content active">
          <p class="admin-instruction">üìç Toque no mapa para selecionar a localiza√ß√£o, ou use sua posi√ß√£o atual.</p>

          <form id="poi-form">
            <div class="form-row">
              <label>Coordenadas</label>
              <div class="coords-display">
                <input type="text" id="poi-lat" placeholder="Latitude" readonly>
                <input type="text" id="poi-lng" placeholder="Longitude" readonly>
              </div>
              <button type="button" id="use-my-location-btn" class="btn-secondary">üìç Usar minha localiza√ß√£o</button>
            </div>

            <div class="form-row">
              <label for="poi-name">Nome do Local</label>
              <input type="text" id="poi-name" placeholder="Ex: Pra√ßa Central" required>
            </div>

            <div class="form-row">
              <label for="poi-type">Tipo</label>
              <select id="poi-type" required>
                <option value="npc">üßô NPC (Quest Giver)</option>
                <option value="clue">üîÆ Pista (AR Object)</option>
                <option value="combat">‚öîÔ∏è Combate</option>
                <option value="boss">‚ò†Ô∏è Boss</option>
                <option value="sanctuary">üè† Santu√°rio (Descanso)</option>
              </select>
            </div>

            <div class="form-row" id="monster-select-row" style="display:none;">
              <label for="poi-monster">Monstro (ID)</label>
              <input type="text" id="poi-monster" placeholder="Ex: zombie, goblin, skeleton (ou vazio para aleat√≥rio)">
              <small style="color: #888;">Deixe vazio para monstro aleat√≥rio baseado no n√≠vel</small>
            </div>

            <div class="form-row" id="dialogue-select-row" style="display:none;">
              <label for="poi-dialogue">Di√°logo do NPC</label>
              <select id="poi-dialogue-type">
                <option value="custom">Texto customizado</option>
                <option value="quest_giver">Quest Giver (Miss√£o)</option>
                <option value="merchant">Mercador</option>
                <option value="simple_greeting">Alde√£o (Sauda√ß√£o)</option>
              </select>
              <textarea id="poi-dialogue-text" placeholder="O que o NPC diz quando voc√™ fala com ele..." rows="3"
                style="margin-top: 8px;"></textarea>
              <small style="color: #888;">Selecione um template ou escreva seu pr√≥prio texto</small>
            </div>

            <div class="form-row">
              <label for="poi-icon">√çcone (emoji)</label>
              <input type="text" id="poi-icon" placeholder="üßô" maxlength="2">
            </div>

            <div class="form-row">
              <label for="poi-radius">Raio de ativa√ß√£o (metros)</label>
              <input type="number" id="poi-radius" value="30" min="10" max="100">
            </div>

            <div class="form-row">
              <label for="poi-description">Descri√ß√£o</label>
              <textarea id="poi-description" placeholder="Uma breve descri√ß√£o do local..." rows="2"></textarea>
            </div>

            <button type="submit" class="btn-primary btn-full">‚úÖ Adicionar POI</button>
          </form>
        </div>

        <!-- Tab: Lista de POIs -->
        <div id="tab-list-pois" class="admin-tab-content">
          <div id="pois-list" class="pois-list">
            <p class="empty-list">Nenhum POI cadastrado ainda.</p>
          </div>
        </div>

        <!-- Tab: Exportar -->
        <div id="tab-export" class="admin-tab-content">
          <p>Exporte a configura√ß√£o para salvar ou compartilhar:</p>
          <textarea id="export-json" readonly rows="10"></textarea>
          <div class="export-buttons">
            <button id="copy-json-btn" class="btn-secondary">üìã Copiar JSON</button>
            <button id="import-json-btn" class="btn-secondary">üì• Importar JSON</button>
          </div>
          <div class="form-row" id="import-section" style="display:none;">
            <textarea id="import-json" placeholder="Cole o JSON aqui..." rows="5"></textarea>
            <button id="confirm-import-btn" class="btn-primary">Confirmar Import</button>
          </div>
        </div>
      </div>
    </div>

    <!-- AR Screen -->
    <div id="ar-screen" class="screen">
      <div id="ar-hud">
        <div class="ar-player-stats">
          <div class="stat-bar hp-bar">
            <span class="stat-label">HP</span>
            <div class="bar-container">
              <div class="bar-fill" id="ar-hp-fill"></div>
            </div>
            <span class="stat-value" id="ar-hp-value">100/100</span>
          </div>
          <div class="stat-bar mana-bar">
            <span class="stat-label">Mana</span>
            <div class="bar-container">
              <div class="bar-fill" id="ar-mana-fill"></div>
            </div>
            <span class="stat-value" id="ar-mana-value">50/50</span>
          </div>
        </div>

        <div class="ar-monster-info" id="ar-monster-info">
          <h3 id="ar-monster-name">Goblin</h3>
          <div class="monster-hp-bar">
            <div class="bar-fill" id="ar-monster-hp-fill"></div>
          </div>
        </div>

        <div class="ar-actions">
          <button class="action-btn" id="attack-btn" data-action="attack">
            <img src="/icons/ui_icon_attack.png" alt="Atacar" class="action-icon-img">
            <span class="action-name">Atacar</span>
          </button>
          <button class="action-btn" id="spell-btn" data-action="spell">
            <img src="/icons/ui_icon_magic.png" alt="Magia" class="action-icon-img">
            <span class="action-name">Magia</span>
          </button>
          <button class="action-btn" id="item-btn" data-action="item">
            <img src="/icons/ui_icon_item.png" alt="Item" class="action-icon-img">
            <span class="action-name">Item</span>
          </button>
          <button class="action-btn" id="dodge-btn" data-action="dodge">
            <img src="/icons/ui_icon_dodge.png" alt="Dodge" class="action-icon-img">
            <span class="action-name">Dodge</span>
          </button>
          <button class="action-btn" id="flee-btn" data-action="flee">
            <img src="/icons/ui_icon_flee.png" alt="Fugir" class="action-icon-img">
            <span class="action-name">Fugir</span>
          </button>
        </div>
      </div>

      <div id="damage-popups"></div>
      <div id="ar-messages"></div>
    </div>

    <!-- Victory Screen -->
    <div id="victory-screen" class="screen overlay">
      <div class="victory-content">
        <h1>Vit√≥ria!</h1>
        <div id="loot-container">
          <h2>Recompensas</h2>
          <div id="xp-gained" class="reward">+0 XP</div>
          <div id="loot-items" class="loot-grid"></div>
        </div>
        <button id="continue-btn" class="btn-primary">Continuar</button>
      </div>
    </div>

    <!-- Inventory Screen -->
    <div id="inventory-screen" class="screen overlay">
      <div class="inventory-container">
        <div class="inventory-header">
          <h1>Invent√°rio</h1>
          <button id="close-inventory-btn" class="btn-close">√ó</button>
        </div>

        <div class="equipment-section">
          <h2>Equipado</h2>
          <div class="equipment-slots">
            <div class="equipment-slot" data-slot="weapon">
              <span class="slot-icon">‚öîÔ∏è</span>
              <span class="slot-name">Arma</span>
              <div class="equipped-item" id="equipped-weapon">Vazio</div>
            </div>
            <div class="equipment-slot" data-slot="armor">
              <span class="slot-icon">üõ°Ô∏è</span>
              <span class="slot-name">Armadura</span>
              <div class="equipped-item" id="equipped-armor">Vazio</div>
            </div>
            <div class="equipment-slot" data-slot="accessory">
              <span class="slot-icon">üíç</span>
              <span class="slot-name">Acess√≥rio</span>
              <div class="equipped-item" id="equipped-accessory">Vazio</div>
            </div>
          </div>
        </div>

        <div class="items-section">
          <h2>Itens</h2>
          <div id="inventory-grid" class="inventory-grid"></div>
        </div>

        <div id="item-details" class="item-details hidden">
          <h3 id="item-name">Item</h3>
          <p id="item-description"></p>
          <div id="item-stats"></div>
          <div class="item-actions">
            <button id="equip-item-btn" class="btn-primary">Equipar</button>
            <button id="unequip-item-btn" class="btn-secondary hidden" style="display: none;">Desequipar</button>
            <button id="use-item-btn" class="btn-secondary">Usar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Exploration Event Screen -->
    <div id="event-screen" class="screen overlay">
      <div class="event-modal">
        <div class="event-icon" id="event-icon">üì¶</div>
        <h2 id="event-title">Ba√∫ Antigo</h2>
        <p id="event-description">Voc√™ encontrou algo...</p>

        <div class="event-options" id="event-options">
          <!-- Populated via JS -->
        </div>

        <button id="close-event-btn" class="btn-secondary hidden" style="display:none;">Fechar</button>
      </div>
    </div>

    <!-- Exploration AR Screen -->
    <div id="exploration-ar-screen" class="screen">
      <div id="exploration-hud">
        <div class="exploration-instructions">
          <div class="instruction-icon" id="exploration-icon">üîç</div>
          <p id="exploration-instruction-text">Procure ao seu redor...</p>
        </div>

        <button id="cancel-exploration-btn" class="btn-cancel">‚úï Cancelar</button>
      </div>

      <div id="exploration-object-info" class="hidden">
        <div class="object-info-content">
          <div class="object-icon" id="found-object-icon">üì¶</div>
          <h3 id="found-object-title">Objeto Encontrado</h3>
          <p id="found-object-desc">Toque no objeto para interagir</p>
        </div>
      </div>
    </div>

    <!-- Character Screen -->
    <div id="character-panel-screen" class="screen overlay">
      <div class="character-panel">
        <div class="character-header">
          <h1>Personagem</h1>
          <button id="close-character-btn" class="btn-close">√ó</button>
        </div>

        <div class="character-identity">
          <div class="character-class-icon" id="char-class-icon">‚öîÔ∏è</div>
          <div class="character-info">
            <span id="char-name">Aventureiro</span>
            <span id="char-class">Guerreiro</span>
            <span id="char-level">N√≠vel 1</span>
          </div>
        </div>

        <div class="xp-section">
          <div class="xp-bar">
            <div class="xp-fill" id="xp-fill"></div>
          </div>
          <span id="xp-text">0 / 150 XP</span>
        </div>

        <div class="attributes-section">
          <h2>Atributos <span id="attribute-points">(0 pontos)</span></h2>
          <div class="attributes-grid">
            <div class="attribute-item">
              <span class="attr-name">FOR</span>
              <span class="attr-value" id="attr-str">10</span>
              <button class="attr-up-btn" data-attr="str">+</button>
            </div>
            <div class="attribute-item">
              <span class="attr-name">DES</span>
              <span class="attr-value" id="attr-dex">10</span>
              <button class="attr-up-btn" data-attr="dex">+</button>
            </div>
            <div class="attribute-item">
              <span class="attr-name">CON</span>
              <span class="attr-value" id="attr-con">10</span>
              <button class="attr-up-btn" data-attr="con">+</button>
            </div>
            <div class="attribute-item">
              <span class="attr-name">INT</span>
              <span class="attr-value" id="attr-int">10</span>
              <button class="attr-up-btn" data-attr="int">+</button>
            </div>
            <div class="attribute-item">
              <span class="attr-name">SAB</span>
              <span class="attr-value" id="attr-wis">10</span>
              <button class="attr-up-btn" data-attr="wis">+</button>
            </div>
            <div class="attribute-item">
              <span class="attr-name">CAR</span>
              <span class="attr-value" id="attr-cha">10</span>
              <button class="attr-up-btn" data-attr="cha">+</button>
            </div>
          </div>
        </div>

        <div class="currency-section">
          <div class="gold-display">üí∞ <span id="char-gold">0</span></div>
        </div>

        <div class="rest-section">
          <h2>Descansar</h2>
          <div class="rest-buttons">
            <button id="rest-short-btn" class="btn-secondary">Descanso Curto</button>
            <button id="rest-long-btn" class="btn-primary">Descanso Longo</button>
          </div>
        </div>

        <div class="stats-section">
          <h2>Estat√≠sticas</h2>
          <div class="stats-grid">
            <div class="stat-item">
              <span class="stat-label">Vida</span>
              <span class="stat-value" id="char-hp">10/10</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Mana</span>
              <span class="stat-value" id="char-mana">10/10</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Defesa (AC)</span>
              <span class="stat-value" id="char-ac">10</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Ataque</span>
              <span class="stat-value" id="char-attack">+0</span>
            </div>
          </div>
        </div>

        <div class="ability-section">
          <h2>Habilidade de Classe</h2>
          <div id="class-ability" class="class-ability">
            <h3 class="ability-name">Habilidade</h3>
            <p class="ability-desc">Descri√ß√£o...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Defeat Screen -->
    <div id="defeat-screen" class="screen overlay">
      <div class="defeat-content">
        <h1>Derrotado...</h1>
        <p>Voc√™ foi incapacitado em combate.</p>
        <p class="penalty">-10% XP do n√≠vel atual</p>
        <button id="respawn-btn" class="btn-primary">Reviver no Santu√°rio</button>
      </div>
    </div>
    <!-- POI Notification Modal -->
    <div id="poi-notification" class="poi-notification hidden">
      <div class="poi-content">
        <div class="poi-icon" id="poi-notif-icon">üìç</div>
        <div class="poi-info">
          <h3>Local Encontrado!</h3>
          <p id="poi-notif-name">Nome do Local</p>
          <p id="poi-notif-desc" class="poi-desc">Descri√ß√£o curta...</p>
        </div>
        <div class="poi-actions" id="poi-notif-actions">
          <button id="poi-action-btn" class="btn-primary">Interagir</button>
          <button id="poi-close-btn" class="btn-secondary">Dispensar</button>
        </div>
      </div>
    </div>

    <!-- Dialogue Modal -->
    <div id="dialogue-modal" class="dialogue-modal">
      <div class="dialogue-container">
        <div class="dialogue-header">
          <div class="dialogue-npc-portrait" id="dialogue-npc-icon">üßô</div>
          <div class="dialogue-npc-info">
            <h3 id="dialogue-npc-name">NPC</h3>
          </div>
        </div>
        <div class="dialogue-content">
          <p id="dialogue-text" class="dialogue-text"></p>
        </div>
        <div id="dialogue-options" class="dialogue-options"></div>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.js"></script>
</body>

</html>